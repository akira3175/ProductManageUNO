<Page
    x:Class="ProductManageUNO.Presentation.ProductDetailPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:ProductManageUNO.Presentation"
    xmlns:models="using:ProductManageUNO.Models"
    xmlns:utu="using:Uno.Toolkit.UI"
    mc:Ignorable="d"
    Background="{ThemeResource BackgroundBrush}">

    <Grid RowDefinitions="Auto, *, Auto" utu:SafeArea.Insets="Top">
        <!-- Header -->
        <Grid Grid.Row="0" Background="{ThemeResource PrimaryBrush}" Padding="16,14,20,18">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" 
                    Background="Transparent"
                    BorderThickness="0"
                    VerticalAlignment="Center"
                    Click="BackButton_Click"
                    Padding="10"
                    CornerRadius="20"
                    ToolTipService.ToolTip="Quay lại">
                <SymbolIcon Symbol="Back" Foreground="{ThemeResource OnPrimaryBrush}"/>
            </Button>

            <TextBlock Grid.Column="1"
                      Text="Chi Tiết Sản Phẩm" 
                      FontSize="24" 
                      FontWeight="Bold"
                      Foreground="{ThemeResource OnPrimaryBrush}"
                      VerticalAlignment="Center"
                      Margin="16,0,0,0"
                      CharacterSpacing="20"/>

            <ProgressRing Grid.Column="2"
                         IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" 
                         Width="26" 
                         Height="26"
                         Foreground="{ThemeResource OnPrimaryBrush}"/>
        </Grid>

        <!-- Content Area -->
        <Grid Grid.Row="1">
            <!-- Loading State -->
            <Grid Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel HorizontalAlignment="Center" 
                           VerticalAlignment="Center" 
                           Spacing="20">
                    <ProgressRing IsActive="True" 
                                 Width="56" 
                                 Height="56"
                                 Foreground="{ThemeResource PrimaryBrush}"/>
                    <TextBlock Text="Đang tải dữ liệu..."
                              FontSize="16"
                              FontWeight="SemiBold"
                              Foreground="{ThemeResource OnSurfaceVariantBrush}"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>

            <!-- Product Content -->
            <ScrollViewer Padding="16,20,16,16"
                         Visibility="{x:Bind ViewModel.Product, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                <StackPanel Spacing="16">
                    <!-- Product Name Card -->
                    <Border Background="{ThemeResource SurfaceBrush}"
                           CornerRadius="16"
                           Padding="22,20"
                           BorderBrush="{ThemeResource OutlineVariantBrush}"
                           BorderThickness="1">
                        <StackPanel Spacing="10">
                            <TextBlock Text="TÊN SẢN PHẨM"
                                      FontSize="11"
                                      FontWeight="SemiBold"
                                      Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                      Opacity="0.8"
                                      CharacterSpacing="80"/>
                            <TextBlock Text="{x:Bind ViewModel.Product.ProductName, Mode=OneWay}"
                                      FontSize="26"
                                      FontWeight="Bold"
                                      Foreground="{ThemeResource OnSurfaceBrush}"
                                      TextWrapping="Wrap"
                                      LineHeight="32"/>
                        </StackPanel>
                    </Border>

                    <!-- Price Card -->
                    <Border Background="{ThemeResource TertiaryContainerBrush}"
                           CornerRadius="16"
                           Padding="22,18"
                           BorderBrush="{ThemeResource OutlineVariantBrush}"
                           BorderThickness="1">
                        <Grid ColumnDefinitions="*,Auto">
                            <StackPanel Grid.Column="0" Spacing="6">
                                <TextBlock Text="GIÁ BÁN"
                                          FontSize="11"
                                          FontWeight="SemiBold"
                                          Foreground="{ThemeResource OnTertiaryContainerBrush}"
                                          Opacity="0.8"
                                          CharacterSpacing="80"/>
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{x:Bind ViewModel.Product.Price, Mode=OneWay, Converter={StaticResource PriceFormatConverter}}"
                                              FontSize="32"
                                              FontWeight="Bold"
                                              Foreground="{ThemeResource OnTertiaryContainerBrush}"/>
                                    <TextBlock Text="VNĐ"
                                              FontSize="16"
                                              FontWeight="SemiBold"
                                              Foreground="{ThemeResource OnTertiaryContainerBrush}"
                                              VerticalAlignment="Bottom"
                                              Margin="0,0,0,6"
                                              Opacity="0.8"/>
                                </StackPanel>
                            </StackPanel>
                            <Border Grid.Column="1"
                                   Background="{ThemeResource OnTertiaryContainerBrush}"
                                   CornerRadius="16"
                                   Padding="16,12"
                                   VerticalAlignment="Center"
                                   Opacity="0.12">
                                <FontIcon Glyph="&#xE8EC;" 
                                         FontSize="36"
                                         Foreground="{ThemeResource OnTertiaryContainerBrush}"/>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Info Grid: Barcode & Unit -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <!-- Barcode -->
                        <Border Grid.Column="0"
                               Background="{ThemeResource SurfaceBrush}"
                               CornerRadius="16"
                               Padding="18"
                               BorderBrush="{ThemeResource OutlineVariantBrush}"
                               BorderThickness="1">
                            <StackPanel Spacing="12">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <Border Background="{ThemeResource PrimaryContainerBrush}" 
                                            CornerRadius="8" 
                                            Padding="8">
                                        <FontIcon Glyph="&#xE1E0;" 
                                                  FontSize="16"
                                                  Foreground="{ThemeResource PrimaryBrush}"/>
                                    </Border>
                                    <TextBlock Text="Mã vạch"
                                              FontSize="13"
                                              Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock Text="{x:Bind ViewModel.Product.Barcode, Mode=OneWay}"
                                          FontSize="17"
                                          FontWeight="SemiBold"
                                          Foreground="{ThemeResource OnSurfaceBrush}"
                                          TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <!-- Unit -->
                        <Border Grid.Column="1"
                               Background="{ThemeResource SurfaceBrush}"
                               CornerRadius="16"
                               Padding="18"
                               BorderBrush="{ThemeResource OutlineVariantBrush}"
                               BorderThickness="1">
                            <StackPanel Spacing="12">
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <Border Background="{ThemeResource PrimaryContainerBrush}" 
                                            CornerRadius="8" 
                                            Padding="8">
                                        <FontIcon Glyph="&#xE7C3;" 
                                                  FontSize="16"
                                                  Foreground="{ThemeResource PrimaryBrush}"/>
                                    </Border>
                                    <TextBlock Text="Đơn vị"
                                              FontSize="13"
                                              Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                              VerticalAlignment="Center"/>
                                </StackPanel>
                                <TextBlock Text="{x:Bind ViewModel.Product.Unit, Mode=OneWay}"
                                          FontSize="17"
                                          FontWeight="SemiBold"
                                          Foreground="{ThemeResource OnSurfaceBrush}"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- Category Card -->
                    <Border Background="{ThemeResource SecondaryContainerBrush}"
                           CornerRadius="16"
                           Padding="20"
                           BorderBrush="{ThemeResource OutlineVariantBrush}"
                           BorderThickness="1">
                        <StackPanel Spacing="12">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <Border Background="{ThemeResource OnSecondaryContainerBrush}" 
                                        CornerRadius="8" 
                                        Padding="8"
                                        Opacity="0.15">
                                    <FontIcon Glyph="&#xE8FD;" 
                                              FontSize="18"
                                              Foreground="{ThemeResource OnSecondaryContainerBrush}"/>
                                </Border>
                                <TextBlock Text="DANH MỤC"
                                          FontSize="11"
                                          FontWeight="SemiBold"
                                          Foreground="{ThemeResource OnSecondaryContainerBrush}"
                                          VerticalAlignment="Center"
                                          Opacity="0.8"
                                          CharacterSpacing="80"/>
                            </StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.Product.Category.CategoryName, Mode=OneWay}"
                                      FontSize="20"
                                      FontWeight="SemiBold"
                                      Foreground="{ThemeResource OnSecondaryContainerBrush}"/>
                        </StackPanel>
                    </Border>

                    <!-- Supplier Card -->
                    <Border Background="{ThemeResource SurfaceBrush}"
                           CornerRadius="16"
                           Padding="20"
                           BorderBrush="{ThemeResource OutlineVariantBrush}"
                           BorderThickness="1">
                        <StackPanel Spacing="16">
                            <!-- Header -->
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <Border Background="{ThemeResource PrimaryContainerBrush}" 
                                        CornerRadius="10" 
                                        Padding="10">
                                    <FontIcon Glyph="&#xE716;" 
                                              FontSize="20"
                                              Foreground="{ThemeResource PrimaryBrush}"/>
                                </Border>
                                <TextBlock Text="Thông tin nhà cung cấp"
                                          FontSize="18"
                                          FontWeight="SemiBold"
                                          Foreground="{ThemeResource OnSurfaceBrush}"
                                          VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Supplier Details -->
                            <StackPanel Spacing="14" Margin="0,4,0,0">
                                <!-- Name -->
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE77B;" 
                                             FontSize="15"
                                             Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                             VerticalAlignment="Top"
                                             Margin="0,3,0,0"/>
                                    <TextBlock Text="{x:Bind ViewModel.Product.Supplier.Name, Mode=OneWay}"
                                              FontSize="16"
                                              FontWeight="SemiBold"
                                              Foreground="{ThemeResource OnSurfaceBrush}"
                                              TextWrapping="Wrap"/>
                                </StackPanel>

                                <!-- Phone -->
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE717;" 
                                             FontSize="15"
                                             Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                             VerticalAlignment="Center"/>
                                    <TextBlock Text="{x:Bind ViewModel.Product.Supplier.Phone, Mode=OneWay}"
                                              FontSize="14"
                                              Foreground="{ThemeResource OnSurfaceVariantBrush}"/>
                                </StackPanel>

                                <!-- Email -->
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE119;" 
                                             FontSize="15"
                                             Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                             VerticalAlignment="Center"/>
                                    <TextBlock Text="{x:Bind ViewModel.Product.Supplier.Email, Mode=OneWay}"
                                              FontSize="14"
                                              Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                              TextWrapping="Wrap"/>
                                </StackPanel>

                                <!-- Address -->
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE707;" 
                                             FontSize="15"
                                             Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                             VerticalAlignment="Top"
                                             Margin="0,3,0,0"/>
                                    <TextBlock Text="{x:Bind ViewModel.Product.Supplier.Address, Mode=OneWay}"
                                              FontSize="14"
                                              Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                              TextWrapping="Wrap"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Created Date -->
                    <Border Background="{ThemeResource SurfaceVariantBrush}"
                           CornerRadius="10"
                           Padding="18,12"
                           HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <FontIcon Glyph="&#xEC92;" 
                                     FontSize="14"
                                     Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                     VerticalAlignment="Center"/>
                            <TextBlock Text="Ngày tạo:"
                                      FontSize="13"
                                      Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                      VerticalAlignment="Center"/>
                            <TextBlock Text="{x:Bind ViewModel.Product.CreatedAt, Mode=OneWay, Converter={StaticResource DateFormatConverter}}"
                                      FontSize="13"
                                      FontWeight="SemiBold"
                                      Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- Spacer for bottom bar -->
                    <Border Height="80"/>
                </StackPanel>
            </ScrollViewer>
            
            <!-- Success Message Toast -->
            <Border Visibility="{x:Bind ViewModel.ShowSuccessMessage, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                    Background="#4CAF50"
                    CornerRadius="12"
                    Padding="16,12"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Margin="0,16,0,0">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <FontIcon Glyph="&#xE73E;" 
                             FontSize="18"
                             Foreground="White"/>
                    <TextBlock Text="{x:Bind ViewModel.AddToCartMessage, Mode=OneWay}"
                              FontSize="14"
                              FontWeight="SemiBold"
                              Foreground="White"/>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- Bottom Add to Cart Section -->
        <Border Grid.Row="2" 
                Background="{ThemeResource SurfaceBrush}"
                BorderBrush="{ThemeResource OutlineVariantBrush}"
                BorderThickness="0,1,0,0"
                Padding="16,12"
                Visibility="{x:Bind ViewModel.Product, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}"
                utu:SafeArea.Insets="Bottom">
            <Grid ColumnDefinitions="Auto, *">
                <!-- Quantity Selector -->
                <Border Grid.Column="0"
                        Background="{ThemeResource SurfaceVariantBrush}"
                        CornerRadius="12"
                        Padding="6"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <!-- Decrease Button -->
                        <Button Command="{x:Bind ViewModel.DecreaseQuantityCommand}"
                                Background="Transparent"
                                BorderThickness="0"
                                Width="40"
                                Height="40"
                                CornerRadius="10"
                                Padding="0"
                                ToolTipService.ToolTip="Giảm số lượng">
                            <FontIcon Glyph="&#xE738;" 
                                     FontSize="18"
                                     Foreground="{ThemeResource PrimaryBrush}"/>
                        </Button>
                        
                        <!-- Quantity Display -->
                        <Border Background="{ThemeResource SurfaceBrush}"
                                CornerRadius="8"
                                Padding="16,8"
                                MinWidth="50">
                            <TextBlock Text="{x:Bind ViewModel.Quantity, Mode=OneWay}"
                                      FontSize="18"
                                      FontWeight="Bold"
                                      Foreground="{ThemeResource OnSurfaceBrush}"
                                      HorizontalAlignment="Center"/>
                        </Border>
                        
                        <!-- Increase Button -->
                        <Button Command="{x:Bind ViewModel.IncreaseQuantityCommand}"
                                Background="Transparent"
                                BorderThickness="0"
                                Width="40"
                                Height="40"
                                CornerRadius="10"
                                Padding="0"
                                ToolTipService.ToolTip="Tăng số lượng">
                            <FontIcon Glyph="&#xE710;" 
                                     FontSize="18"
                                     Foreground="{ThemeResource PrimaryBrush}"/>
                        </Button>
                    </StackPanel>
                </Border>
                
                <!-- Add to Cart Button -->
                <Button Grid.Column="1"
                        Command="{x:Bind ViewModel.AddToCartCommand}"
                        Background="{ThemeResource PrimaryBrush}"
                        Foreground="{ThemeResource OnPrimaryBrush}"
                        CornerRadius="12"
                        Padding="20,14"
                        Margin="12,0,0,0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <ProgressRing IsActive="{x:Bind ViewModel.IsAddingToCart, Mode=OneWay}"
                                     Width="20"
                                     Height="20"
                                     Foreground="{ThemeResource OnPrimaryBrush}"
                                     Visibility="{x:Bind ViewModel.IsAddingToCart, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
                        <FontIcon Glyph="&#xE7BF;" 
                                 FontSize="20"
                                 Foreground="{ThemeResource OnPrimaryBrush}"/>
                        <TextBlock Text="Thêm vào giỏ"
                                  FontSize="16"
                                  FontWeight="SemiBold"
                                  Foreground="{ThemeResource OnPrimaryBrush}"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
</Page>


